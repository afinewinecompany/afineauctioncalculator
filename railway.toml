# Railway configuration for backend API deployment
# Frontend is deployed separately on Vercel

[build]
builder = "nixpacks"
# Build backend only (skip frontend build)
buildCommand = "npx prisma generate && npm run build:backend"

# Install Chromium for Puppeteer scraping
[build.nixpacks]
aptPkgs = ["chromium"]

[deploy]
# Run migrations then start the backend API
startCommand = "npx prisma migrate deploy && npm run start:backend"
healthcheckPath = "/api/health"
healthcheckTimeout = 60
restartPolicyType = "on_failure"
restartPolicyMaxRetries = 5

[env]
# Chromium path for puppeteer-core
CHROME_BIN = "/usr/bin/chromium"

# Railway will auto-inject these from plugins:
# - DATABASE_URL (PostgreSQL plugin)
# - REDIS_URL (Redis plugin, optional)

# Set these in Railway dashboard:
# - NODE_ENV=production
# - JWT_SECRET=<64-char-hex-string>
# - JWT_REFRESH_SECRET=<64-char-hex-string>
# - FRONTEND_URL=https://your-vercel-app.vercel.app
# - CORS_ORIGINS=https://your-vercel-app.vercel.app
