# Railway configuration for unified frontend + backend deployment
# Single service serving both API and static frontend files

[build]
builder = "nixpacks"
# Build both frontend and backend (npm ci is handled by Nixpacks install phase)
buildCommand = "npx prisma generate && npm run build"

[deploy]
# Run migrations then start the backend (which also serves frontend static files)
startCommand = "npx prisma migrate deploy && npm run start:backend"
healthcheckPath = "/api/health"
healthcheckTimeout = 60
restartPolicyType = "on_failure"
restartPolicyMaxRetries = 5

[env]
# Railway will auto-inject these from plugins:
# - DATABASE_URL (PostgreSQL plugin)
# - REDIS_URL (Redis plugin, optional)

# Set these in Railway dashboard:
# - NODE_ENV=production
# - JWT_SECRET=<64-char-hex-string>
# - JWT_REFRESH_SECRET=<64-char-hex-string>
# - FRONTEND_URL=https://your-app.railway.app (same as service URL)
# - CORS_ORIGINS=https://your-app.railway.app
